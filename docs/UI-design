## 1. Purpose and Scope

**RTH Core UI** is the **administrative control plane** for a Reticulum Telemetry Hub (RTH) instance.

It is intended for:

* Operators of RTH nodes (fixed, mobile, or gateway)
* Administrators managing telemetry, topics, users, and configuration
* Situational awareness and network hygiene (abuse prevention, blackholing)

This  is **not a UI client** (Sideband/MeshChat equivalent), but a **server management console**.

---

## 2. Architectural Overview

### 2.1 High-Level Architecture

```
┌──────────────────────────┐
│        Web Browser       │
│  (RTH Core UI – SPA)     │
└──────────┬───────────────┘
           │ HTTPS / WSS
           │
┌──────────▼───────────────┐
│   RTH Web API Layer      │
│  FastAPI + WebSockets    │
└──────────┬───────────────┘
           │ Internal Calls
┌──────────▼───────────────┐
│      RTH Core Engine     │
│  (Telemetry, Topics,     │
│   LXMF, RNS, Config)     │
└──────────────────────────┘
```

### 2.2 Communication Model

| Channel   | Technology                  | Purpose                             |
| --------- | --------------------------- | ----------------------------------- |
| REST API  | FastAPI (JSON)              | Commands, CRUD, configuration       |
| WebSocket | FastAPI WS                  | Live telemetry, node status, events |
| Auth      | Token-based (JWT / API Key) | Admin & operator access             |

Commands are split into **Public** (end users) and **Protected** (admin UI).
Every REST endpoint maps to a corresponding LXMF command, and all LXMF commands
are exposed over REST.

---

## 3. UI Technology Stack 

| Layer     | Recommendation                               |
| --------- | -------------------------------------------- |
| Frontend  | Vue 3                          |
| Mapping   | MapLibre GL JS (offline-capable, non-Google) |
| Styling   | TailwindCSS + custom dark theme              |
| State     | Pinia                                        |
| Transport | REST + WebSocket                             |
| Packaging | Static build served by RTH or reverse proxy  |

---

## 4. UI Style Guide

### 4.1 Visual Identity

Based on provided screenshots:

* **Dark, low-contrast tactical theme**
* **Desaturated world map**
* **Minimal color accents (cyan / electric blue)**
* **Flat UI, no gradients**
* **High-legibility fonts**

#### Colors (indicative)

| Role              | Color             |
| ----------------- | ----------------- |
| Background        | #0F1320 / #141828|
| Panels            | #1B2033           |
| Primary Accent    | #4DB6FF           |
| Warning           | Amber             |
| Error / Ban       | Red               |
| Telemetry Markers | Cyan / Magenta    |

### 4.2 Layout

* **Left vertical navigation bar**
* Fixed sections:

  * Home
  * WebMap
  * Mission
  * User
  * Connect
  * Configure
  * About
* Main panel is **content-driven**, no modal overload

---

## 5. Functional Modules

---

## 5.1 Dashboard (Home)

### Purpose

Provide immediate system situational awareness.

### Features

* RTH uptime
* CPU / memory load
* Number of connected nodes
* Active telemetry streams
* Message throughput (LXMF / telemetry)
* Alerts (misbehaving nodes, bans)

### Data Source

* REST: `GET /Status`, `GET /Events`
* WS: `/events/system` (status + event stream)

---

## 5.2 WebMap (Telemetry Visualization)

### Core Capability

**Live, global map rendering of telemetry entities**.

### Features

* Display:

  * Nodes
  * Clients
  * Sensors
  * Assets (vehicles, devices)
* Marker clustering
* Time-based replay (optional phase 2)
* Filter by:

  * Topic
  * Source identity
  * Telemetry type

### Telemetry Model
* time (timestamp)
* location (latitude, longitude, altitude, speed, bearing, accuracy, last_update)
* physical_link (rssi, snr, q)
* battery (charge_percent, charging, temperature)
* environment (temperature, humidity, pressure, ambient_light)
* motion (acceleration, angular_velocity, magnetic_field, gravity, proximity)
* system (processor, ram, nvm, power_consumption, power_production)
* network (received, rns_transport, lxmf_propagation, connection_map)
* custom (plugin-defined payloads)

### Data Flow
* Initial load: REST `GET /Telemetry?since=<unix>&topic_id=<TopicID>` (maps to LXMF `TelemetryRequest` command `1`).
* Live updates: WS `/telemetry/stream` (topic-scoped).
* Telemetry requests may include `TopicID`; hub returns data only for peers subscribed to that topic.

---

## 5.3 Topics Management

### Purpose

Control **logical fan-out and semantic routing**.

### Features
* List topics (`ListTopic`)
* Create / update / delete topics (`CreateTopic`, `PatchTopic`, `DeleteTopic`) [Protected]
* Retrieve topic details (`RetrieveTopic`)
* Subscribe destinations (`SubscribeTopic`)
* Manage subscribers (`ListSubscriber`, `CreateSubscriber` / `AddSubscriber`, `PatchSubscriber`, `DeleteSubscriber` / `RemoveSubscriber`)

### UI Pattern

Table-based management (similar to data package screenshot).

### API
* `GET /Topic`
* `GET /Topic/{id}`
* `POST /Topic` [Protected]
* `PATCH /Topic` [Protected]
* `DELETE /Topic?id=<TopicID>` [Protected]
* `POST /Topic//Subscribe`

---

## 5.4 File & Image Browser

### Purpose

Expose RTH as a **content distribution node**.

### Features
* Browse stored files and images (`ListFiles`, `ListImages`)
* Preview images (UI-only)
* View attachment metadata (size, media type, topic_id)
* Retrieve attachments by `FileID` (`RetrieveFile`, `RetrieveImage`)
* Upload/delete/visibility are future (requires new commands).

### Use Cases

* Map tiles
* Mission images
* Shared documents
* Static assets for field nodes

### API
* `GET /File`
* `GET /Image`
* `GET /File/{id}`
* `GET /Image/{id}`

---

## 5.5 User & Identity Management

### Identity Model

* RNS Destination Hash
* Optional alias

### Features
* List joined clients (`ListClients`)
* View activity and metadata (`Client.last_seen`, `Client.metadata`)
* Join / leave hub (`join`, `leave`)
* Role assignment is future.
* Ban/unban/blackhole are protected commands.

### Blackhole Capability

* Planned: prevent routing, drop announces, block telemetry and LXMF.

### API
* `GET /Client` [Protected]
* `GET /Identities` [Protected]
* `POST /Client/{id}/Ban` [Protected]
* `POST /Client/{id}/Unban` [Protected]
* `POST /Client/{id}/Blackhole` [Protected]
* `POST /RTH?identity=<hex>`
* `PUT /RTH`

---

## 5.6 Configuration Management

### Purpose

Expose and manage the **RTH configuration file** safely.

### Features

* View config (editable)
* Schema validation
* Diff preview before apply
* Restart-required warnings

### Safety Controls

* Role-based access
* Versioned backups
* Rollback

### API
* `GET /Config` [Protected]
* `PUT /Config` [Protected]
* `POST /Config/Validate` [Protected]
* `POST /Config/Rollback` [Protected]
* `GET /api/v1/app/info` (public metadata)

---

## 5.7 Command Console (Advanced)

### Purpose

Expose **all RTH commands** in a controlled way.

### Features

* Structured command execution
* Audit log
* Read-only mode for observers

### Examples

* Help / Examples
* GetStatus, ListEvents
* ListTopic, CreateTopic, PatchTopic, DeleteTopic
* ListClients, ListIdentities, getAppInfo
* ListFiles / ListImages, RetrieveFile / RetrieveImage
* TelemetryRequest (`1`) with optional `TopicID`
* FlushTelemetry, ReloadConfig, DumpRouting

---

## 6. Security Model

| Aspect        | Approach                    |
| ------------- | --------------------------- |
| Auth          | JWT / API Key               |
| Transport     | HTTPS + WSS                 |
| RBAC          | Role-based                  |
| Audit         | Immutable action log        |
| Abuse Control | RNS blackhole + rate limits |

---

## 7. Web UI Exposure Plan

### Phase 1 – Embedded UI

* UI served directly by RTH
* Suitable for small / private nodes

### Phase 2 – External UI

* UI served via reverse proxy
* RTH API exposed behind auth
* Enables:

  * Multi-node dashboards
  * Federation views

### Phase 3 – Federation

* Multiple RTH instances
* Aggregated telemetry
* Cross-hub topic bridges

---

## 8. Non-Goals (Explicit)

* No dependency on cloud services
* No Google Maps
* No centralized identity registry
* No assumption of continuous connectivity

---

## 9. Alignment with Reticulum Philosophy

* Offline-first
* Cryptographic identity as first-class
* No implicit trust
* Minimal bandwidth overhead
* Operator sovereignty

---

## 10. Deliverables @CODEX

1. OpenAPI specification for RTH UI backend
2. WebSocket event schema
3. UI wireframes (derived from screenshots)
4. RBAC policy definition
5. Configuration schema (JSON/YAML)

---

If required next steps:

* Produce **OpenAPI spec** aligned with Commands
* Generate **UI wireframes**
* Define **WebSocket event contracts**
* Create **reference implementation skeleton**
